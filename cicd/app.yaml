---
# Source: blog/templates/namespace.yaml
apiVersion: v1
kind: Namespace
metadata:
  name: dev
---
# Source: blog/templates/app.yml
---

apiVersion: v1
data:
  POSTGRES_DB: YmxvZw==
  POSTGRES_DRIVER: b3JnLnBvc3RncmVzcWwuRHJpdmVy
  POSTGRES_NAMESPACE: ZGV2
  POSTGRES_PASSWORD: bWFpbl9wYXNz
  POSTGRES_PORT: NTQzMg==
  POSTGRES_URL: YmxvZy1kYi1zdmM=
  POSTGRES_USER: bWFpbl91c2Vy
kind: Secret
metadata:
  name: db-env-secret
  namespace: dev
  labels:
    app.kubernetes.io/name: blog-db-env-secret
    app.kubernetes.io/instance: blog
    app.kubernetes.io/version: "1.0.0"
    app.kubernetes.io/managed-by: Helm
---
# Source: blog/templates/app.yml
---

apiVersion: v1
data:
  PGADMIN_DEFAULT_EMAIL: bWFpbEBvcmcuY29t
  PGADMIN_DEFAULT_PASSWORD: cGctcGFzcw==
kind: Secret
metadata:
  name: pgadmin-secret
  namespace: dev
  labels:
    app.kubernetes.io/name: blog-pgadmin-secret
    app.kubernetes.io/instance: blog
    app.kubernetes.io/version: "1.0.0"
    app.kubernetes.io/managed-by: Helm
---
# Source: blog/templates/liquidbase-configfile.yml
apiVersion: v1
kind: ConfigMap #хранит параметры контейнера
metadata:
  name: liquidbase-configfile #имя конфига
  namespace: dev
data: #Данные хранящие в мапе
  liquibase.properties: |
    url= jdbc:postgresql://blog-db-svc.dev:5432/blog
    username= main_user
    password= main_pass
    changeLogFile= changelog/db.changelog-master.yml
    driver= org.postgresql.Driver
---
# Source: blog/templates/app.yml
apiVersion: v1
kind: Service
metadata:
  name: blog-app-svc
  namespace: dev
spec:
  type: NodePort
  selector:
    app.kubernetes.io/name: blog-app
    app.kubernetes.io/instance: blog
  ports:
    - protocol: TCP
      port: 8080
      targetPort: 8080
      nodePort: 30022
---
# Source: blog/templates/app.yml
apiVersion: v1
kind: Service
metadata:
  name: blog-db-svc
  namespace: dev
spec:
  selector:
    app.kubernetes.io/name: blog-db
    app.kubernetes.io/instance: blog
  ports:
    - protocol: TCP
      port: 5432
      targetPort: 5432
---
# Source: blog/templates/app.yml
apiVersion: v1
kind: Service
metadata:
  name: blog-pgadmin-svc
  namespace: dev
spec:
  type: NodePort
  selector:
    app.kubernetes.io/name: blog-pgadmin
    app.kubernetes.io/instance: blog
  ports:
    - protocol: TCP
      port: 8080
      targetPort: 80
      nodePort: 30002
---
# Source: blog/templates/app.yml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: blog-app-deployment
  namespace: dev
  labels:
    app.kubernetes.io/name: blog-app
    app.kubernetes.io/instance: blog
    app.kubernetes.io/version: "1.0.0"
    app.kubernetes.io/managed-by: Helm
spec:
  replicas: 2
  selector:
    matchLabels:
      app.kubernetes.io/name: blog-app
      app.kubernetes.io/instance: blog
  template:
    metadata:
      annotations:
        checksum_db-env-secret : 7d33cecb6f0688d62bd0624c23c686ba4c1051b63e2fa67dbf14109e8aca24ab
      labels:
        app.kubernetes.io/name: blog-app
        app.kubernetes.io/instance: blog
        app.kubernetes.io/version: "1.0.0"
        app.kubernetes.io/managed-by: Helm
    spec:
      containers:
        - name: app
          image: blog:1.0.0
          ports:
            - containerPort: 8080
          resources:
            requests:
              memory: 256M
              cpu: 100m
            limits:
              memory: 256M
              cpu: 200m
          command:
            - java
          args:
            - -jar
            - blog-0.0.1.jar
          envFrom:
            - secretRef:
                name: db-env-secret
---
# Source: blog/templates/app.yml
---

apiVersion: apps/v1
kind: Deployment
metadata:
  name: blog-db-deployment
  namespace: dev
  labels:
    app.kubernetes.io/name: blog-db
    app.kubernetes.io/instance: blog
    app.kubernetes.io/version: "1.0.0"
    app.kubernetes.io/managed-by: Helm
spec:
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/name: blog-db
      app.kubernetes.io/instance: blog
  template:
    metadata:
      annotations:
        checksum_db-env-secret : 7d33cecb6f0688d62bd0624c23c686ba4c1051b63e2fa67dbf14109e8aca24ab
      labels:
        app.kubernetes.io/name: blog-db
        app.kubernetes.io/instance: blog
        app.kubernetes.io/version: "1.0.0"
        app.kubernetes.io/managed-by: Helm
    spec:
      containers:
        - name: db
          image: postgres_blog:1.0.0
          ports:
            - containerPort: 5432
          resources:
            requests:
              memory: 256M
              cpu: 100m
            limits:
              memory: 256M
              cpu: 200m
          envFrom:
            - secretRef:
                name: db-env-secret
---
# Source: blog/templates/app.yml
---

apiVersion: apps/v1
kind: Deployment
metadata:
  name: blog-liquibase-deployment
  namespace: dev
  labels:
    app.kubernetes.io/name: blog-liquibase
    app.kubernetes.io/instance: blog
    app.kubernetes.io/version: "1.0.0"
    app.kubernetes.io/managed-by: Helm
spec:
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/name: blog-liquibase
      app.kubernetes.io/instance: blog
  template:
    metadata:
      annotations:
        checksum_db-env-secret : 7d33cecb6f0688d62bd0624c23c686ba4c1051b63e2fa67dbf14109e8aca24ab
        checksum_liquidbase-configfile : 3bc1bbdad14c3a284c92653953ffc86e65e70aaa5a38ffd3a6bbe67645847675
      labels:
        app.kubernetes.io/name: blog-liquibase
        app.kubernetes.io/instance: blog
        app.kubernetes.io/version: "1.0.0"
        app.kubernetes.io/managed-by: Helm
    spec:
      containers:
        - name: liquibase
          image: liquibase:4.12d
          ports:
            - containerPort: 8080
          resources:
            requests:
              memory: 256M
              cpu: 100m
            limits:
              memory: 256M
              cpu: 200m
          command:
            - /bin/sh
          args:
            - liquibase
            - update
            - --defaults-file=/liquibase/changelog/liquibase.properties
          envFrom:
            - secretRef:
                name: db-env-secret      
          volumeMounts:
            - mountPath: /liquibase/changelog/liquibase.properties
              name: liquidbase-configfile
              subPath: liquibase.properties
      volumes:
        - name: liquidbase-configfile
          configMap:
            name: liquidbase-configfile
---
# Source: blog/templates/app.yml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: blog-pgadmin-deployment
  namespace: dev
  labels:
    app.kubernetes.io/name: blog-pgadmin
    app.kubernetes.io/instance: blog
    app.kubernetes.io/version: "1.0.0"
    app.kubernetes.io/managed-by: Helm
spec:
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/name: blog-pgadmin
      app.kubernetes.io/instance: blog
  template:
    metadata:
      annotations:
        checksum_db-env-secret : 7d33cecb6f0688d62bd0624c23c686ba4c1051b63e2fa67dbf14109e8aca24ab
      labels:
        app.kubernetes.io/name: blog-pgadmin
        app.kubernetes.io/instance: blog
        app.kubernetes.io/version: "1.0.0"
        app.kubernetes.io/managed-by: Helm
    spec:
      containers:
        - name: pgadmin
          image: pgadmin_blog:1.0.0
          ports:
            - containerPort: 80
          resources:
            requests:
              memory: 256M
              cpu: 100m
            limits:
              memory: 256M
              cpu: 200m
          envFrom:
            - secretRef:
                name: db-env-secret
---
# Source: blog/templates/app.yml
---
